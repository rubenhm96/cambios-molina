jQuery(function(t){t(".wp-restaurant-listings-file-upload").each(function(){t(this).fileupload({dataType:"json",dropZone:t(this),url:restaurant_listings_ajax_file_upload.ajax_url.toString().replace("%%endpoint%%","upload_file"),maxNumberOfFiles:1,formData:{script:!0},add:function(e,i){var a=t(this),r=a.closest("form"),n=a.parent().find(".restaurant-listings-uploaded-files"),s=[],l=t(this).data("file_types");if(l){var o=new RegExp("(.|/)("+l+")$","i");i.originalFiles[0].name.length&&!o.test(i.originalFiles[0].name)&&s.push(restaurant_listings_ajax_file_upload.i18n_invalid_file_type+" "+l)}s.length>0?window.alert(s.join("\n")):(r.find(':input[type="submit"]').attr("disabled","disabled"),i.context=t('<progress value="" max="100"></progress>').appendTo(n),i.submit())},progress:function(t,e){var i=parseInt(e.loaded/e.total*100,10);e.context.val(i)},fail:function(e,i){var a=t(this).closest("form");i.errorThrown&&window.alert(i.errorThrown),i.context.remove(),a.find(':input[type="submit"]').removeAttr("disabled")},done:function(e,i){var a=t(this),r=a.closest("form"),n=a.parent().find(".restaurant-listings-uploaded-files"),s=a.attr("multiple")?1:0,l=["jpg","gif","png","jpeg","jpe"];i.context.remove(),void 0===i.result.success||i.result.success||window.alert(i.result.data),t.each(i.result.files,function(e,i){var r;i.error?window.alert(i.error):(t.inArray(i.extension,l)>=0?(r=t.parseHTML(restaurant_listings_ajax_file_upload.js_field_html_img),t(r).find(".restaurant-listings-uploaded-file-preview img").attr("src",i.url)):(r=t.parseHTML(restaurant_listings_ajax_file_upload.js_field_html),t(r).find(".restaurant-listings-uploaded-file-name code").text(i.name)),t(r).find(".input-text").val(i.url),t(r).find(".input-text").attr("name","current_"+a.attr("name")),s?n.append(r):n.html(r))}),r.find(':input[type="submit"]').removeAttr("disabled")}})})});